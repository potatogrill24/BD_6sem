# ИНДЕКСЫ

### Для запуска файла ввести команду: 
```bash
docker exec -i store_db psql -U postgres -d store < tasks/indexes.sql
`


**Запрос на выборку заказов (orders) по дате:**

- Без индекса: время выполнения ~2431.7 мс.
- С индексом: время выполнения ~1072.6 мс.

Индекс на поле order_date значительно ускоряет выполнение запроса.

**Запрос на выборку пользователей по email:**

- Без индекса: время выполнения ~1050.6 мс (с использованием параллельного сканирования).
- С индексом: время выполнения ~0.05 мс (с использованием Bitmap Index Scan).

Индекс на поле email дает потрясающее улучшение скорости — запрос стал выполняться практически мгновенно.

**Запрос на выборку пользователей по фамилии:**

- Без индекса: время выполнения ~733.1 мс.
- С индексом: время выполнения ~281.7 мс.

Индекс на поле last_name также значительно ускоряет запрос, несмотря на использование LIKE с регулярным выражением.

**Запрос на выборку отзывов по ключевому слову в комментарии:**

- Без индекса: время выполнения ~2068.96 мс.
- С индексом: время выполнения ~172.1 мс.

Индекс на поле comment (с использованием trigrams) дает заметное ускорение для поиска по строкам.

**Запрос на выборку товаров в заказах с использованием фильтра по order_id:**

- Без индекса: время выполнения ~688.0 мс.
- С индексом: время выполнения ~247.5 мс.

Индекс на поле order_id также ускоряет выполнение запроса, используя Bitmap Index Scan и параллельную обработку.

**Запрос на выборку пользователей по дате регистрации:**

- Без индекса: время выполнения ~460.7 мс.
- С индексом: время выполнения ~454.1 мс.

Этот запрос показывает меньшую разницу в производительности, так как он использует диапазон дат, и увеличение скорости не такое заметное по сравнению с другими запросами.

## Вывод:
Индексы значительно улучшили время выполнения запросов, особенно для фильтров по полям email, last_name, и comment. Они позволяют PostgreSQL быстро находить нужные строки, избегая полного сканирования таблицы. Для некоторых запросов ускорение довольно заметное, например, для поиска по email и фамилии.


# ТРАНЗАКЦИИ

### Для запуска файла ввести команды:
```bash
# 1) docker exec -it store_db psql -U postgres -d store
# 2) docker exec -it store_db psql -U postgres -d store (в другом терминале)
`

Далее запускать транзакции по блокам и смотреть, что будет с БД. Проверить все аномалии.


# РАСШИРЕНИЯ

### Для запуска файла ввести команду:
```bash
docker exec -i store_db psql -U postgres -d store < tasks/extensions.sql
`

## Плюсы и минусы использования pg_bigm, pg_trgm
- `pg_trgm` лучше использовать для похожих форм слов и "умного" поиска.
- `pg_bigm` подходит для простого подстрочного поиска с LIKE, особенно в коротких строках.

## Влияние pgcrypto на безопасность данных

**Плюсы:**
- Защита персональных данных в случае утечки базы данных.
- Шифрование/дешифровка на уровне SQL-запросов.
- Гибкость — можно шифровать только определённые поля.

**Минусы:**
- Нет возможности использовать индексы по зашифрованным полям.
- Требуется защита ключа (`secret_key`) на уровне приложения.
- Замедление чтения при расшифровке.

## Вывод:
`pgcrypto` увеличивает уровень безопасности, особенно в случаях с конфиденциальной информацией, но требует дополнительных мер по защите ключей и учёту влияния на производительность.
